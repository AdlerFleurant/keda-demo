apiVersion: apps/v1
kind: Deployment
metadata:
  namespace: keda-demo
  name: processor
spec:
  selector:
    matchLabels:
      app: processor
  replicas: 1
  template:
    metadata:
      labels:
        app: processor
    spec:
      containers:
      - name: container
        image: image-registry.openshift-image-registry.svc:5000/keda-demo/processor:latest
        env:
        - name: AMQP_HOST
          value: artemis-default-0-svc
        - name: AMQP_PORT
          value: '5672'
        - name: REQUESTS_ADDRESS
          value: quotes:requests
        - name: RESPONSES_ADDRESS
          value: quotes:responses
---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: consumer
  namespace: keda-demo
spec:
  scaleTargetRef:
    name: processor
  minReplicaCount:  0                                # Optional. Default: 0
  maxReplicaCount:  10                              # Optional. Default: 100
  fallback:                                          # Optional. Section to specify fallback options
    failureThreshold: 3                              # Mandatory if fallback section is included
    replicas: 5                                      # Mandatory if fallback section is included
  triggers:
  - type: artemis-queue
    metadata:
      managementEndpoint: "artemis-wconsj-0-svc-rte-keda-demo.apps.cluster-vm2k6.vm2k6.sandbox2819.opentlc.com:80"
      queueName: "requests"
      brokerName: "amq-broker"
      brokerAddress: "quote-requests"
      queueLength: '10'
      activationQueueLength: '1'
      username: 'quarkus'
      password: 'quarkus'
